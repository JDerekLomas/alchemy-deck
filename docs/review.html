<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Alchemy Deck - Card Review</title>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;1,400;1,500&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: #1a1612;
      color: #eee;
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      margin-bottom: 30px;
    }

    h1 {
      color: #d4af37;
      font-family: 'Cinzel', serif;
      font-size: 1.6rem;
      font-weight: 500;
      letter-spacing: 0.05em;
      margin-bottom: 10px;
    }

    .progress {
      background: #2a2420;
      border-radius: 10px;
      height: 6px;
      margin: 15px 0;
      overflow: hidden;
    }

    .progress-bar {
      background: linear-gradient(90deg, #d4af37, #f4cf47);
      height: 100%;
      transition: width 0.3s;
    }

    .progress-text {
      color: #888;
      font-size: 0.85rem;
    }

    .review-area {
      display: flex;
      gap: 50px;
      margin-bottom: 30px;
      align-items: flex-start;
    }

    /* === CARD STYLES === */
    .card-wrapper {
      flex: 0 0 auto;
    }

    .card {
      width: 2.75in;
      height: 4.75in;
      border-radius: 0.125in;
      overflow: hidden;
      background: #0d0a08;
      display: flex;
      flex-direction: column;
      border: 1px solid #3d3530;
      box-shadow: 0 15px 50px rgba(0,0,0,0.6);
      transform: scale(1.35);
      transform-origin: top left;
      margin-bottom: 160px;
      margin-right: 100px;
    }

    .card .artwork {
      height: 2.75in;
      overflow: hidden;
      background: linear-gradient(135deg, #2a2420 0%, #1a1612 100%);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .card .artwork img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center;
    }

    .card .text-panel {
      padding: 10px 12px 6px;
      border-top: 2px solid rgba(212, 175, 55, 0.5);
    }

    .card .category {
      font-family: 'Cinzel', serif;
      font-size: 7px;
      font-weight: 600;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      margin-bottom: 3px;
    }

    .card .title {
      font-family: 'Cinzel', serif;
      font-size: 16px;
      font-weight: 600;
      color: #fff;
      line-height: 1.1;
      letter-spacing: 0.02em;
    }

    .card .subtitle {
      font-family: 'Cormorant Garamond', serif;
      font-size: 11px;
      font-style: italic;
      color: rgba(255,255,255,0.65);
      margin-top: 2px;
      letter-spacing: 0.02em;
    }

    .card .prompt-area {
      padding: 8px 12px;
      font-size: 9.5px;
      line-height: 1.5;
      color: rgba(255,255,255,0.92);
      flex: 1;
      overflow: hidden;
      font-family: 'Cormorant Garamond', serif;
      font-weight: 500;
    }

    .card .quote {
      font-family: 'Cormorant Garamond', serif;
      font-style: italic;
      color: #d4af37;
      font-size: 8px;
      padding: 6px 12px 8px;
      border-top: 1px solid rgba(212, 175, 55, 0.25);
      line-height: 1.35;
      letter-spacing: 0.01em;
    }

    /* Category colors */
    .card.stage .text-panel, .card.stage .prompt-area { background: linear-gradient(to bottom, #2d1f3d, #1f1629); }
    .card.stage .category { color: #c084fc; }
    .card.stage.nigredo .text-panel, .card.stage.nigredo .prompt-area { background: linear-gradient(to bottom, #1a1a1a, #0d0d0d); }
    .card.stage.nigredo .category { color: #666; }
    .card.stage.albedo .text-panel, .card.stage.albedo .prompt-area { background: linear-gradient(to bottom, #3d3d3d, #2a2a2a); }
    .card.stage.albedo .category { color: #e0e0e0; }
    .card.stage.citrinitas .text-panel, .card.stage.citrinitas .prompt-area { background: linear-gradient(to bottom, #4d4020, #3d3018); }
    .card.stage.citrinitas .category { color: #f5c542; }
    .card.stage.rubedo .text-panel, .card.stage.rubedo .prompt-area { background: linear-gradient(to bottom, #4d1a20, #3d1018); }
    .card.stage.rubedo .category { color: #e63946; }

    .card.operation .text-panel, .card.operation .prompt-area { background: linear-gradient(to bottom, #4d2a10, #3d2008); }
    .card.operation .category { color: #ff8c42; }

    .card.element .text-panel, .card.element .prompt-area { background: linear-gradient(to bottom, #1a3d3a, #132d2b); }
    .card.element .category { color: #4ecdc4; }
    .card.element.fire .text-panel, .card.element.fire .prompt-area { background: linear-gradient(to bottom, #4d1a1a, #3d1313); }
    .card.element.fire .category { color: #e63946; }
    .card.element.water .text-panel, .card.element.water .prompt-area { background: linear-gradient(to bottom, #1a2a4d, #132039); }
    .card.element.water .category { color: #457b9d; }
    .card.element.air .text-panel, .card.element.air .prompt-area { background: linear-gradient(to bottom, #2a3d4d, #1f2f3d); }
    .card.element.air .category { color: #a8dadc; }
    .card.element.earth .text-panel, .card.element.earth .prompt-area { background: linear-gradient(to bottom, #2d3d1a, #1f2d13); }
    .card.element.earth .category { color: #606c38; }
    .card.element.quintessence .text-panel, .card.element.quintessence .prompt-area { background: linear-gradient(to bottom, #2d1f4d, #1f1639); }
    .card.element.quintessence .category { color: #6c5ce7; }

    .card.principle .text-panel, .card.principle .prompt-area { background: linear-gradient(to bottom, #4a3d10, #3d3008); }
    .card.principle .category { color: #ffd166; }

    .card.vessel .text-panel, .card.vessel .prompt-area { background: linear-gradient(to bottom, #3d2a1a, #2d1f13); }
    .card.vessel .category { color: #d4a574; }

    .card.sage .text-panel, .card.sage .prompt-area { background: linear-gradient(to bottom, #1a2a3d, #131f2d); }
    .card.sage .category { color: #60a5fa; }

    .card.arcana .text-panel, .card.arcana .prompt-area { background: linear-gradient(to bottom, #3d1a3d, #2d132d); }
    .card.arcana .category { color: #e879f9; }

    /* === RATING PANEL === */
    .rating-panel {
      flex: 1;
      max-width: 580px;
    }

    .rating-section {
      background: rgba(255,255,255,0.03);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 15px;
      border: 1px solid rgba(255,255,255,0.06);
    }

    .rating-section h3 {
      margin-bottom: 15px;
      color: #d4af37;
      font-family: 'Cinzel', serif;
      font-size: 0.95rem;
      font-weight: 500;
    }

    .rating-buttons {
      display: flex;
      gap: 10px;
      margin-bottom: 18px;
    }

    .rating-btn {
      flex: 1;
      padding: 14px;
      border: 2px solid #333;
      background: transparent;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 5px;
    }

    .rating-btn:hover {
      border-color: #555;
      background: rgba(255,255,255,0.03);
    }

    .rating-btn.selected {
      border-color: #d4af37;
      background: rgba(212, 175, 55, 0.08);
    }

    .rating-btn .emoji { font-size: 1.8rem; }
    .rating-btn .label { color: #777; font-size: 0.75rem; }
    .rating-btn.selected .label { color: #d4af37; }

    .rating-btn.thumbs-up.selected { border-color: #4ade80; background: rgba(74, 222, 128, 0.08); }
    .rating-btn.thumbs-up.selected .label { color: #4ade80; }
    .rating-btn.meh.selected { border-color: #fbbf24; background: rgba(251, 191, 36, 0.08); }
    .rating-btn.meh.selected .label { color: #fbbf24; }
    .rating-btn.thumbs-down.selected { border-color: #f87171; background: rgba(248, 113, 113, 0.08); }
    .rating-btn.thumbs-down.selected .label { color: #f87171; }

    .prompt-section {
      background: rgba(0,0,0,0.25);
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 12px;
    }

    .prompt-section label {
      display: block;
      margin-bottom: 6px;
      color: #777;
      font-size: 0.8rem;
      font-weight: 500;
    }

    .prompt-section .current-prompt {
      font-family: 'SF Mono', 'Monaco', 'Inconsolata', monospace;
      font-size: 0.72rem;
      color: #999;
      line-height: 1.5;
      background: rgba(0,0,0,0.3);
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #2a2a2a;
    }

    textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #333;
      background: #1a1a1a;
      color: #eee;
      border-radius: 6px;
      font-family: inherit;
      font-size: 0.85rem;
      resize: vertical;
      min-height: 70px;
    }

    textarea:focus {
      outline: none;
      border-color: #d4af37;
    }

    textarea::placeholder { color: #555; }

    textarea.prompt-edit {
      font-family: 'SF Mono', 'Monaco', 'Inconsolata', monospace;
      font-size: 0.72rem;
    }

    .nav-buttons {
      display: flex;
      gap: 15px;
      justify-content: space-between;
    }

    .nav-btn {
      padding: 12px 28px;
      border: none;
      border-radius: 8px;
      font-size: 0.95rem;
      cursor: pointer;
      transition: all 0.2s;
      font-family: 'Cinzel', serif;
      font-weight: 500;
    }

    .nav-btn.prev { background: #2a2a2a; color: #ccc; }
    .nav-btn.prev:hover { background: #333; }
    .nav-btn.next {
      background: linear-gradient(135deg, #d4af37, #e5c048);
      color: #1a1a2e;
      font-weight: 600;
    }
    .nav-btn.next:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(212, 175, 55, 0.25);
    }
    .nav-btn:disabled { opacity: 0.4; cursor: not-allowed; }

    .filter-buttons {
      display: flex;
      gap: 8px;
      margin-bottom: 20px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .filter-btn {
      padding: 6px 14px;
      border: 1px solid #333;
      background: transparent;
      color: #777;
      border-radius: 20px;
      cursor: pointer;
      font-size: 0.75rem;
    }

    .filter-btn.active {
      border-color: #d4af37;
      color: #d4af37;
    }

    .summary-section {
      margin-top: 30px;
      padding: 22px;
      background: rgba(255,255,255,0.03);
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.06);
    }

    .summary-section h2 {
      color: #d4af37;
      font-family: 'Cinzel', serif;
      margin-bottom: 15px;
      font-size: 1.1rem;
      font-weight: 500;
    }

    .summary-stats {
      display: flex;
      gap: 25px;
      margin-bottom: 15px;
    }

    .stat { text-align: center; }
    .stat-number { font-size: 1.6rem; font-weight: bold; }
    .stat-label { color: #777; font-size: 0.8rem; }
    .stat.good .stat-number { color: #4ade80; }
    .stat.meh .stat-number { color: #fbbf24; }
    .stat.bad .stat-number { color: #f87171; }

    .export-btn {
      padding: 11px 22px;
      background: #d4af37;
      color: #1a1a2e;
      border: none;
      border-radius: 8px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      font-family: 'Cinzel', serif;
    }

    .keyboard-hint {
      text-align: center;
      color: #555;
      font-size: 0.7rem;
      margin-top: 15px;
    }

    .keyboard-hint kbd {
      background: #2a2a2a;
      padding: 2px 6px;
      border-radius: 4px;
      margin: 0 2px;
    }

    @media (max-width: 1000px) {
      .review-area {
        flex-direction: column;
        align-items: center;
      }
      .card {
        transform: scale(1.25);
        margin-bottom: 100px;
        margin-right: 0;
      }
      .rating-panel {
        max-width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Alchemy Deck Review</h1>
      <div class="progress">
        <div class="progress-bar" id="progressBar"></div>
      </div>
      <div class="progress-text" id="progressText">Card 1 of 34</div>

      <div class="filter-buttons">
        <button class="filter-btn active" data-filter="all">All (34)</button>
        <button class="filter-btn" data-filter="unreviewed">Unreviewed</button>
        <button class="filter-btn" data-filter="up">Approved</button>
        <button class="filter-btn" data-filter="meh">Needs Work</button>
        <button class="filter-btn" data-filter="down">Rejected</button>
      </div>
    </header>

    <div class="review-area">
      <div class="card-wrapper">
        <div class="card" id="cardElement">
          <div class="artwork">
            <img id="cardImage" src="" alt="">
          </div>
          <div class="text-panel">
            <div class="category" id="cardCategory"></div>
            <div class="title" id="cardTitle"></div>
            <div class="subtitle" id="cardSubtitle"></div>
          </div>
          <div class="prompt-area" id="cardPrompt"></div>
          <div class="quote" id="cardQuote"></div>
        </div>
      </div>

      <div class="rating-panel">
        <div class="rating-section">
          <h3>Rate this card</h3>
          <div class="rating-buttons">
            <button class="rating-btn thumbs-up" data-rating="up">
              <span class="emoji">üëç</span>
              <span class="label">Good to print</span>
            </button>
            <button class="rating-btn meh" data-rating="meh">
              <span class="emoji">üòê</span>
              <span class="label">Needs tweaking</span>
            </button>
            <button class="rating-btn thumbs-down" data-rating="down">
              <span class="emoji">üëé</span>
              <span class="label">Regenerate</span>
            </button>
          </div>

          <div class="prompt-section">
            <label>Current Image Prompt:</label>
            <div class="current-prompt" id="currentPrompt"></div>
          </div>

          <div class="prompt-section">
            <label>Revised Prompt (edit to improve):</label>
            <textarea id="revisedPrompt" class="prompt-edit" placeholder="Edit the prompt to improve the image..."></textarea>
          </div>

          <div class="prompt-section">
            <label>Notes:</label>
            <textarea id="commentInput" placeholder="e.g., 'Image too dark', 'Composition off-center'..."></textarea>
          </div>
        </div>

        <div class="nav-buttons">
          <button class="nav-btn prev" id="prevBtn">‚Üê Previous</button>
          <button class="nav-btn next" id="nextBtn">Next ‚Üí</button>
        </div>

        <div class="keyboard-hint">
          <kbd>‚Üê</kbd> <kbd>‚Üí</kbd> navigate &nbsp; <kbd>1</kbd> approve &nbsp; <kbd>2</kbd> meh &nbsp; <kbd>3</kbd> reject
        </div>
      </div>
    </div>

    <div class="summary-section" id="summarySection" style="display: none;">
      <h2>Review Summary</h2>
      <div class="summary-stats">
        <div class="stat good">
          <div class="stat-number" id="goodCount">0</div>
          <div class="stat-label">Approved</div>
        </div>
        <div class="stat meh">
          <div class="stat-number" id="mehCount">0</div>
          <div class="stat-label">Needs Work</div>
        </div>
        <div class="stat bad">
          <div class="stat-number" id="badCount">0</div>
          <div class="stat-label">Rejected</div>
        </div>
      </div>
      <button class="export-btn" id="exportBtn">Export Review Data</button>
    </div>
  </div>

  <script>
    const BASE_STYLE = "Detailed alchemical engraving illustration, hand-tinted with muted earth tones and gold accents, copper and sepia coloring, mystical Renaissance style, intricate linework, esoteric symbolism, aged parchment texture, high detail, centered composition, no text or letters";

    const cards = [
      // STAGES
      {
        id: "stage-01", type: "stage", subtype: "nigredo",
        category: "Stage", title: "Nigredo", subtitle: "Blackening",
        prompt: "Ravens circle a black sun. The old form dies in the vessel. What must you face in the darkness? What shadow holds the seed of change?",
        quote: '"I am black, white, yellow, and red." ‚ÄîMaier',
        imagePrompt: "Nigredo blackening stage, dark ravens circling a black sun, decomposing matter in vessel, skull and bones, death symbolism, sol niger, dark smoke rising, putrefaction"
      },
      {
        id: "stage-02", type: "stage", subtype: "albedo",
        category: "Stage", title: "Albedo", subtitle: "Whitening",
        prompt: "A white dove emerges from darkness. The blackened matter is washed to silver-white. What clarity is emerging? What is being purified?",
        quote: '"Water purifies all imperfect things." ‚ÄîSendivogius',
        imagePrompt: "Albedo whitening stage, white dove emerging, silver moon, purified white substance in glass vessel, pearl, snow white rose, washing waters, lunar symbolism"
      },
      {
        id: "stage-03", type: "stage", subtype: "citrinitas",
        category: "Stage", title: "Citrinitas", subtitle: "Yellowing",
        prompt: "Golden light breaks over the horizon. The white matter yellows as consciousness stirs. What wisdom is dawning? What first light do you glimpse?",
        quote: '"The vulture cries: I am white and black, yellow and red." ‚ÄîMaier',
        imagePrompt: "Citrinitas yellowing stage, golden dawn breaking, solar rays piercing clouds, yellow sulfur, sunrise over alchemical landscape, awakening light, vulture on mountain summit"
      },
      {
        id: "stage-04", type: "stage", subtype: "rubedo",
        category: "Stage", title: "Rubedo", subtitle: "Reddening",
        prompt: "Phoenix rises from flames. Sun and moon unite in sacred marriage. The red stone is born. What wholeness is possible? What is ready to be complete?",
        quote: '"The fixed becomes volatile; the volatile, fixed." ‚ÄîKhunrath',
        imagePrompt: "Rubedo reddening stage, phoenix rising from flames, red philosopher's stone, sacred marriage of sun and moon, royal wedding, red rose, blood red elixir, completion"
      },

      // OPERATIONS
      {
        id: "op-01", type: "operation",
        category: "Operation", title: "Calcination", subtitle: "Burning",
        prompt: "Fierce flames reduce matter to white ash. The ego's shell cracks open in the fire. What must be burned away? What attachments need releasing?",
        quote: '"All impurities are purified by fire." ‚ÄîSendivogius',
        imagePrompt: "Calcination operation, fierce flames consuming matter, white ash in crucible, salamander in fire, burning away impurities, reduction by fire, glowing embers"
      },
      {
        id: "op-02", type: "operation",
        category: "Operation", title: "Dissolution", subtitle: "Dissolving",
        prompt: "Ash dissolves into dark waters. Rigid structures melt away. Where must you surrender control? What emotions need to flow?",
        quote: '"Water joins together everything dissolved." ‚ÄîSendivogius',
        imagePrompt: "Dissolution operation, matter dissolving in dark water, tears and rain, moon reflected in pool, sea serpent, watery depths, melting forms, emotional release"
      },
      {
        id: "op-03", type: "operation",
        category: "Operation", title: "Separation", subtitle: "Discerning",
        prompt: "A sword divides light from dark. Eagle rises, toad sinks. What must be separated? What distinction needs making?",
        quote: '"Fire separates everything that is joined." ‚ÄîSendivogius',
        imagePrompt: "Separation operation, sword dividing light and darkness, eagle ascending toad descending, filtering pure from impure, wheat from chaff, scales of discernment"
      },
      {
        id: "op-04", type: "operation",
        category: "Operation", title: "Conjunction", subtitle: "Uniting",
        prompt: "King and Queen embrace. Sun and moon merge into one. Opposites unite in the vessel. What seeks integration within you?",
        quote: '"The animated spirit is joined to the body." ‚ÄîKhunrath',
        imagePrompt: "Conjunction operation, sacred marriage of king and queen, sun and moon joining, hermaphrodite rebis, chemical wedding, two becoming one, embrace of opposites"
      },
      {
        id: "op-05", type: "operation",
        category: "Operation", title: "Fermentation", subtitle: "Inspiring",
        prompt: "The peacock's tail shimmers with iridescent colors. Decay births new life. What inspiration is arising from crisis? What new growth stirs?",
        quote: '"Nature gives motion, motion excites fire." ‚ÄîSendivogius',
        imagePrompt: "Fermentation operation, peacock tail cauda pavonis, iridescent colors, rotting matter birthing new life, bubbling ferment, yeast and transformation, inspiration arising"
      },
      {
        id: "op-06", type: "operation",
        category: "Operation", title: "Distillation", subtitle: "Refining",
        prompt: "Vapors rise through the alembic, condense, fall, rise again. Repeated cycles of refinement. What essence needs extracting? What requires further purification?",
        quote: '"The tincture represents the Soul." ‚ÄîDrebbel',
        imagePrompt: "Distillation operation, alembic with rising vapors, condensing drops, eagle ascending, dew collecting, copper still, purified essence, repeated refinement cycles"
      },
      {
        id: "op-07", type: "operation",
        category: "Operation", title: "Coagulation", subtitle: "Manifesting",
        prompt: "The distilled essence crystallizes into solid form. Spirit becomes matter. The Stone manifests. What is ready to take form? How does insight become reality?",
        quote: '"Let it slowly coagulate in a warm place." ‚ÄîDrebbel',
        imagePrompt: "Coagulation operation, philosopher's stone forming, crystallization process, solid gold emerging, phoenix egg, manifested perfection, spirit becoming matter"
      },

      // ELEMENTS
      {
        id: "elem-01", type: "element", subtype: "fire",
        category: "Element", title: "Fire", subtitle: "Will",
        prompt: "Roaring flames, the salamander dancing within. The upward-pointing triangle. Where is the fire needed? What calls for transforming action?",
        quote: '"Fire acts in wonderful hidden ways." ‚ÄîSendivogius',
        imagePrompt: "Elemental fire, roaring flames, salamander spirit dancing in fire, upward triangle symbol, solar rays, burning torch, volcanic power, transformative heat"
      },
      {
        id: "elem-02", type: "element", subtype: "water",
        category: "Element", title: "Water", subtitle: "Emotion",
        prompt: "Flowing streams, the undine spirit moving in depths. The downward-pointing triangle. What feelings need acknowledgment? What seeks to flow?",
        quote: '"Water purifies all imperfect things." ‚ÄîSendivogius',
        imagePrompt: "Elemental water, flowing streams, undine water spirit, downward triangle symbol, lunar tides, fish and waves, dissolving waters, emotional depths"
      },
      {
        id: "elem-03", type: "element", subtype: "air",
        category: "Element", title: "Air", subtitle: "Thought",
        prompt: "Swirling winds, sylphs in flight. The triangle with crossbar. What thoughts need expression? What communication is required?",
        quote: '"Motion excites air, air excites fire." ‚ÄîSendivogius',
        imagePrompt: "Elemental air, swirling winds, sylph air spirits, birds in flight, clouds and sky, breath of life, intellectual clarity, feathers floating"
      },
      {
        id: "elem-04", type: "element", subtype: "earth",
        category: "Element", title: "Earth", subtitle: "Body",
        prompt: "Mountains and caves, crystals growing in darkness. The inverted triangle with crossbar. What is the material reality? What needs grounding?",
        quote: '"Earth receives the Tincture." ‚ÄîSendivogius',
        imagePrompt: "Elemental earth, mountains and caves, gnome earth spirit, crystals growing, roots and stones, fertile soil, material foundation, underground treasures"
      },
      {
        id: "elem-05", type: "element", subtype: "quintessence",
        category: "Element", title: "Quintessence", subtitle: "Spirit",
        prompt: "Starry cosmos, spiraling galaxy, celestial light beyond the four. The eternal, unchanging essence. What transcends the material? What is the spiritual core?",
        quote: '"The Quintessence is eternal, immutable." ‚ÄîDrebbel',
        imagePrompt: "Fifth element quintessence, starry cosmos, spiraling galaxy, divine celestial light, ethereal spirit, transcendent essence, celestial sphere, stars within"
      },

      // PRINCIPLES
      {
        id: "prin-01", type: "principle",
        category: "Principle", title: "Sulphur", subtitle: "Soul",
        prompt: "Burning sun, golden flames, the solar king. The combustible principle, what gives life and desire. What does the soul want? What animates this situation?",
        quote: '"Sulphur, Salt, Mercury‚Äîthe three called Prima Materia." ‚ÄîParacelsus',
        imagePrompt: "Alchemical sulphur principle, burning sun, solar king with golden flames, combustible spirit, active masculine force, lion, fiery soul essence"
      },
      {
        id: "prin-02", type: "principle",
        category: "Principle", title: "Mercury", subtitle: "Spirit",
        prompt: "Winged messenger, caduceus staff, quicksilver flowing. What moves between realms? What message is being carried? Where is the mediating force?",
        quote: '"From living quicksilver comes the prima materia." ‚ÄîRosicrucian MS',
        imagePrompt: "Alchemical mercury principle, winged messenger Hermes, caduceus staff with serpents, quicksilver flowing, volatile spirit, hermaphrodite, mediating force"
      },
      {
        id: "prin-03", type: "principle",
        category: "Principle", title: "Salt", subtitle: "Body",
        prompt: "White crystals, the cubic stone, what remains after fire. The fixed principle, the body that contains spirit. What is the form? What structure holds this?",
        quote: '"The Sun is fire, salt, and base." ‚ÄîParacelsus',
        imagePrompt: "Alchemical salt principle, crystalline white cube, fixed body form, salt crystals, foundation stone, preserved matter, cubic structure, material base"
      },

      // VESSELS
      {
        id: "vessel-01", type: "vessel",
        category: "Vessel", title: "Athanor", subtitle: "The Furnace",
        prompt: "Tower oven with steady, patient flame. The egg-shaped vessel maintains constant heat over time. What requires sustained attention? Where is patience the path?",
        quote: '"With one Athanor furnace; and one fire." ‚ÄîKhunrath',
        imagePrompt: "Alchemical athanor furnace, tower brick oven, steady patient flame, philosophical egg vessel inside, constant gentle heat, tower furnace design"
      },
      {
        id: "vessel-02", type: "vessel",
        category: "Vessel", title: "Alembic", subtitle: "The Still",
        prompt: "Glass apparatus with curved head where vapors rise and condense. Drops of pure essence collect. What needs distilling? How to extract what matters?",
        quote: '"Extract tincture from the cucurbit." ‚ÄîDrebbel',
        imagePrompt: "Alchemical alembic still, elegant glass apparatus, curved condensing head, vapor rising and falling, drops of essence collecting, copper and glass still"
      },
      {
        id: "vessel-03", type: "vessel",
        category: "Vessel", title: "Crucible", subtitle: "The Test",
        prompt: "Ceramic pot glowing red in fierce flame. Matter is tested, proved, transformed. What is being tested? What must withstand the fire to prove its nature?",
        quote: '"The body dies, turns black, reduced to ashes." ‚ÄîKhunrath',
        imagePrompt: "Alchemical crucible, ceramic pot glowing red-hot, fierce flames, molten contents, trial by fire, testing vessel, transformation under heat"
      },
      {
        id: "vessel-04", type: "vessel",
        category: "Vessel", title: "Retort", subtitle: "The Return",
        prompt: "Bent-neck flask returns condensed vapors to the body. The pelican feeding its young with its own blood. What must circulate? What returns to source?",
        quote: '"It begins where it ends." ‚ÄîHermes',
        imagePrompt: "Alchemical retort vessel, bent-neck flask, pelican vessel feeding young, circulating vapors, philosophical circulation, return to source, ouroboric process"
      },

      // SAGES
      {
        id: "sage-01", type: "sage",
        category: "Sage", title: "Hermes", subtitle: "Trismegistus",
        prompt: "Thrice-Great Hermes. The Emerald Tablet, the ibis, pyramids at dawn. As above, so below. How does the macrocosm mirror the microcosm?",
        quote: '"Man bore the image of his father." ‚ÄîPymander',
        imagePrompt: "Hermes Trismegistus, Egyptian-Greek sage with ibis head, emerald tablet, pyramids, caduceus staff, thrice-great master, as above so below gesture"
      },
      {
        id: "sage-02", type: "sage",
        category: "Sage", title: "Paracelsus", subtitle: "The Physician",
        prompt: "Swiss physician-alchemist with sword Azoth at his side. Nature is the teacher. What does nature teach here? What is the medicine needed?",
        quote: '"These three are Prima Materia, like God." ‚ÄîParacelsus',
        imagePrompt: "Paracelsus physician alchemist, Renaissance doctor, sword Azoth, medical herbs and vessels, natural philosophy, wild beard, healing arts laboratory"
      },
      {
        id: "sage-03", type: "sage",
        category: "Sage", title: "Boehme", subtitle: "The Mystic",
        prompt: "German shoemaker-mystic. Divine vision broke through while mending shoes. Aurora, the dawn light. What is the divine spark here? What vision is possible?",
        quote: '"Heaven is the Sea of Fire, from the 7 Spirits." ‚ÄîAurora',
        imagePrompt: "Jacob Boehme mystic, humble shoemaker with divine vision, aurora dawn light breaking through, mystical eye, theosophical symbols, spiritual illumination"
      },
      {
        id: "sage-04", type: "sage",
        category: "Sage", title: "Ficino", subtitle: "The Translator",
        prompt: "Florentine philosopher who brought Hermes to the Renaissance. The Platonic Academy, lyre music, candlelight over ancient texts. Where is beauty leading the soul?",
        quote: '"Hermes attempted to eradicate this stain from souls." ‚ÄîOn Pleasure',
        imagePrompt: "Marsilio Ficino, Florentine philosopher translating by candlelight, ancient Greek texts, lyre instrument, platonic academy, Renaissance humanism, beauty and soul"
      },
      {
        id: "sage-05", type: "sage",
        category: "Sage", title: "Sendivogius", subtitle: "The Adept",
        prompt: "Polish adept-diplomat with practical laboratory wisdom. Understood nature's secret fire. What does practical wisdom say? What is the clear path forward?",
        quote: '"Fire acts in wonderful hidden ways." ‚ÄîNew Chemical Light',
        imagePrompt: "Michael Sendivogius, Polish alchemist in laboratory, practical apparatus, new chemical light rays, philosophical mercury, adept in scholarly robes"
      },
      {
        id: "sage-06", type: "sage",
        category: "Sage", title: "Agrippa", subtitle: "The Magus",
        prompt: "German polymath. Three Books of Occult Philosophy. Pentagram, celestial correspondences. What hidden forces are at work? What correspondences apply?",
        quote: '"God impresses the seal of Ideas upon Intelligences." ‚ÄîOccult Philosophy',
        imagePrompt: "Cornelius Agrippa, occult philosopher, three books open, pentagram, celestial correspondences diagram, hidden wisdom, magical arts, starry ceiling"
      },

      // ARCANA
      {
        id: "arc-01", type: "arcana",
        category: "Arcana", title: "Prima Materia", subtitle: "First Matter",
        prompt: "Chaos before creation, the cosmic egg floating in dark waters. Formless potential, raw material of the Great Work. What is the raw material here? What potential lies unformed?",
        quote: '"The Prima Materia is a divine mist." ‚ÄîHellwig',
        imagePrompt: "Prima materia first matter, chaotic void, cosmic egg in dark waters, unformed potential, primordial chaos, divine mist, creation beginning, formless substance"
      },
      {
        id: "arc-02", type: "arcana",
        category: "Arcana", title: "Lapis", subtitle: "The Stone",
        prompt: "Radiant red stone, ruby crystal glowing with inner fire. Transmutes lead to gold, heals all disease. The perfected self. What would complete the work?",
        quote: '"He is praised in the Emerald Tablet... the living fire." ‚ÄîHellwig',
        imagePrompt: "Philosopher's stone lapis, radiant glowing red ruby, inner fire, transmutation power, perfect gem, golden light emanating, completed great work"
      },
      {
        id: "arc-03", type: "arcana",
        category: "Arcana", title: "Ouroboros", subtitle: "Eternal Return",
        prompt: "Dragon in eternal circle, scales shifting from light to dark. End becomes beginning. Self-renewal through self-consumption. What cycle is completing?",
        quote: '"It begins where it ends." ‚ÄîHermes',
        imagePrompt: "Ouroboros serpent dragon, eating its own tail, eternal cycle, infinity symbol, scales light to dark, self-renewal, cosmic snake, beginning and end united"
      },
      {
        id: "arc-04", type: "arcana",
        category: "Arcana", title: "Rebis", subtitle: "The Double",
        prompt: "Hermaphrodite figure, two heads on one body, sun and moon crowning left and right. Perfect union of opposites. What dualities seek resolution?",
        quote: '"Man bore the image of his father." ‚ÄîPymander',
        imagePrompt: "Rebis hermaphrodite, two-headed figure, sun and moon crowns, male and female merged, perfect union of opposites, alchemical androgyne, dual nature united"
      },
      {
        id: "arc-05", type: "arcana",
        category: "Arcana", title: "Elixir", subtitle: "The Medicine",
        prompt: "Golden liquid in a crystal vial, glowing with life. Panacea, the drinkable gold. Universal medicine for body and soul. What healing is needed?",
        quote: '"The tincture heals all diseases... represents the Soul." ‚ÄîDrebbel',
        imagePrompt: "Elixir of life, golden glowing liquid in crystal vessel, universal medicine panacea, healing light, immortality potion, perfected tincture, aurum potabile"
      }
    ];

    let currentIndex = 0;
    let currentFilter = 'all';
    let filteredCards = [...cards];
    let reviews = JSON.parse(localStorage.getItem('alchemyDeckReviews') || '{}');

    const cardElement = document.getElementById('cardElement');
    const cardImage = document.getElementById('cardImage');
    const cardCategory = document.getElementById('cardCategory');
    const cardTitle = document.getElementById('cardTitle');
    const cardSubtitle = document.getElementById('cardSubtitle');
    const cardPrompt = document.getElementById('cardPrompt');
    const cardQuote = document.getElementById('cardQuote');
    const currentPromptEl = document.getElementById('currentPrompt');
    const revisedPromptEl = document.getElementById('revisedPrompt');
    const commentInput = document.getElementById('commentInput');
    const progressBar = document.getElementById('progressBar');
    const progressText = document.getElementById('progressText');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const summarySection = document.getElementById('summarySection');

    function applyFilter(filter) {
      currentFilter = filter;
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.filter === filter);
      });

      if (filter === 'all') filteredCards = [...cards];
      else if (filter === 'unreviewed') filteredCards = cards.filter(c => !reviews[c.id]?.rating);
      else filteredCards = cards.filter(c => reviews[c.id]?.rating === filter);

      currentIndex = 0;
      updateDisplay();
      updateFilterCounts();
    }

    function updateFilterCounts() {
      const counts = {
        all: cards.length,
        unreviewed: cards.filter(c => !reviews[c.id]?.rating).length,
        up: cards.filter(c => reviews[c.id]?.rating === 'up').length,
        meh: cards.filter(c => reviews[c.id]?.rating === 'meh').length,
        down: cards.filter(c => reviews[c.id]?.rating === 'down').length
      };
      document.querySelectorAll('.filter-btn').forEach(btn => {
        const filter = btn.dataset.filter;
        const label = filter === 'all' ? 'All' : filter === 'unreviewed' ? 'Unreviewed' : filter === 'up' ? 'Approved' : filter === 'meh' ? 'Needs Work' : 'Rejected';
        btn.textContent = `${label} (${counts[filter]})`;
      });
    }

    function updateDisplay() {
      if (filteredCards.length === 0) {
        cardImage.src = '';
        cardCategory.textContent = '';
        cardTitle.textContent = 'No cards';
        cardSubtitle.textContent = '';
        cardPrompt.textContent = 'Try a different filter.';
        cardQuote.textContent = '';
        currentPromptEl.textContent = '';
        return;
      }

      const card = filteredCards[currentIndex];
      const review = reviews[card.id] || {};

      let cardClass = `card ${card.type}`;
      if (card.subtype) cardClass += ` ${card.subtype}`;
      cardElement.className = cardClass;

      cardImage.src = `cards/${card.id}.png`;
      cardImage.alt = card.title;
      cardCategory.textContent = card.category;
      cardTitle.textContent = card.title;
      cardSubtitle.textContent = card.subtitle;
      cardPrompt.textContent = card.prompt;
      cardQuote.textContent = card.quote;

      const fullPrompt = `${BASE_STYLE}, ${card.imagePrompt}`;
      currentPromptEl.textContent = fullPrompt;
      revisedPromptEl.value = review.revisedPrompt || '';
      commentInput.value = review.comment || '';

      document.querySelectorAll('.rating-btn').forEach(btn => {
        btn.classList.toggle('selected', btn.dataset.rating === review.rating);
      });

      const progress = ((currentIndex + 1) / filteredCards.length) * 100;
      progressBar.style.width = `${progress}%`;
      progressText.textContent = `Card ${currentIndex + 1} of ${filteredCards.length}`;

      prevBtn.disabled = currentIndex === 0;
      nextBtn.textContent = currentIndex === filteredCards.length - 1 ? 'Finish' : 'Next ‚Üí';

      updateSummary();
    }

    function saveReview(rating) {
      const card = filteredCards[currentIndex];
      if (!reviews[card.id]) reviews[card.id] = {};
      reviews[card.id].rating = rating;
      reviews[card.id].comment = commentInput.value;
      reviews[card.id].revisedPrompt = revisedPromptEl.value;
      reviews[card.id].timestamp = new Date().toISOString();
      localStorage.setItem('alchemyDeckReviews', JSON.stringify(reviews));
      updateDisplay();
      updateFilterCounts();
    }

    function saveInputs() {
      const card = filteredCards[currentIndex];
      if (!reviews[card.id]) reviews[card.id] = {};
      reviews[card.id].comment = commentInput.value;
      reviews[card.id].revisedPrompt = revisedPromptEl.value;
      localStorage.setItem('alchemyDeckReviews', JSON.stringify(reviews));
    }

    function updateSummary() {
      const reviewedCount = Object.keys(reviews).filter(k => reviews[k].rating).length;
      if (reviewedCount > 0) {
        summarySection.style.display = 'block';
        document.getElementById('goodCount').textContent = Object.values(reviews).filter(r => r.rating === 'up').length;
        document.getElementById('mehCount').textContent = Object.values(reviews).filter(r => r.rating === 'meh').length;
        document.getElementById('badCount').textContent = Object.values(reviews).filter(r => r.rating === 'down').length;
      }
    }

    function exportReviews() {
      const exportData = {
        exported: new Date().toISOString(),
        baseStyle: BASE_STYLE,
        summary: {
          total: cards.length,
          approved: Object.values(reviews).filter(r => r.rating === 'up').length,
          needsWork: Object.values(reviews).filter(r => r.rating === 'meh').length,
          rejected: Object.values(reviews).filter(r => r.rating === 'down').length,
          unreviewed: cards.filter(c => !reviews[c.id]?.rating).length
        },
        cards: cards.map(card => ({
          ...card,
          fullPrompt: `${BASE_STYLE}, ${card.imagePrompt}`,
          review: reviews[card.id] || { rating: null, comment: '', revisedPrompt: '' }
        }))
      };
      const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `alchemy-deck-review-${new Date().toISOString().split('T')[0]}.json`;
      a.click();
    }

    document.querySelectorAll('.rating-btn').forEach(btn => btn.addEventListener('click', () => saveReview(btn.dataset.rating)));
    document.querySelectorAll('.filter-btn').forEach(btn => btn.addEventListener('click', () => applyFilter(btn.dataset.filter)));
    commentInput.addEventListener('blur', saveInputs);
    revisedPromptEl.addEventListener('blur', saveInputs);
    prevBtn.addEventListener('click', () => { saveInputs(); if (currentIndex > 0) { currentIndex--; updateDisplay(); } });
    nextBtn.addEventListener('click', () => { saveInputs(); if (currentIndex < filteredCards.length - 1) { currentIndex++; updateDisplay(); } });
    document.getElementById('exportBtn').addEventListener('click', exportReviews);

    document.addEventListener('keydown', (e) => {
      if (e.target === commentInput || e.target === revisedPromptEl) return;
      if (e.key === 'ArrowLeft' && currentIndex > 0) { saveInputs(); currentIndex--; updateDisplay(); }
      else if (e.key === 'ArrowRight' && currentIndex < filteredCards.length - 1) { saveInputs(); currentIndex++; updateDisplay(); }
      else if (e.key === '1') saveReview('up');
      else if (e.key === '2') saveReview('meh');
      else if (e.key === '3') saveReview('down');
    });

    updateDisplay();
    updateFilterCounts();
  </script>
</body>
</html>
